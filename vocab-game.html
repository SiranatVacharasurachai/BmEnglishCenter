<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Vocab Rain ‚Äî BM English</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600,700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#fbfcfd;--card:#fff;--accent:#0ea5a0;--muted:#6b7280;--text:#0f172a}
    *{box-sizing:border-box}
    body{font-family:'Poppins',Segoe UI,Roboto,Arial,sans-serif;margin:0;min-height:100vh;color:var(--text);background:linear-gradient(180deg,#fff 0%,#f8fafc 100%)}
    header{padding:1rem;border-bottom:1px solid #eef3f6}
    .container{max-width:1100px;margin:0 auto;padding:0 1rem}
    .title-row{display:flex;align-items:center;gap:1rem;justify-content:space-between}
    a.back, .back{color:var(--muted);text-decoration:none;padding:.5rem .8rem;border-radius:8px;border:1px solid #e6eef0;background:transparent;font-size:.95rem}
    .controls{display:flex;gap:.6rem;align-items:center}

    .game-area{margin-top:1.25rem;background:linear-gradient(180deg,#fff 0%,#f8fffb 100%);border:1px solid #e6eef0;border-radius:12px;padding:1rem;position:relative;overflow:hidden;height:66vh}
    .center-vocab{position:absolute;left:50%;top:45%;transform:translate(-50%,-50%);background:var(--card);padding:1rem 1.2rem;border-radius:12px;border:1px solid #e6eef0;z-index:60;min-width:220px;text-align:center;pointer-events:none}
    .center-vocab .word{font-size:1.5rem;font-weight:700}
    .meta{display:flex;gap:1rem;align-items:center;color:var(--muted);font-weight:600}

    .falling-img{position:absolute;left:0;top:-160px;width:90px;height:90px;object-fit:cover;border-radius:10px;border:1px solid #e6eef0;box-shadow:0 12px 30px rgba(2,6,23,.08);cursor:pointer;animation-timing-function:linear}
    @keyframes fall { to { transform: translateY(130vh); } }

    /* Prominent start button placed below the play area */
    .start-btn{display:block;max-width:320px;margin:12px auto 0;text-align:center;background:var(--accent);color:#fff;padding:.85rem 1rem;border-radius:999px;border:0;font-weight:700;box-shadow:0 10px 22px rgba(14,165,160,.12);font-size:1.02rem;cursor:pointer}
    .start-btn:focus{outline:3px solid rgba(14,165,160,.15);outline-offset:3px}
    @media (max-width:700px){ .start-btn{padding:.9rem 1rem;font-size:1rem;margin-top:10px} }

    .overlay{position:absolute;inset:0;background:linear-gradient(180deg,transparent 0%, rgba(2,6,23,0.02) 100%);pointer-events:none}
    .status{margin-top:.75rem;color:var(--muted)}
    .result{margin-top:1rem;padding:1rem;background:#fff;border-radius:10px;border:1px solid #e6eef0}

    #tutorial{position:absolute;inset:0;display:none;z-index:70;align-items:center;justify-content:center;pointer-events:auto}
    #tutorial .panel{max-width:720px;margin:auto;background:#fff;border-radius:12px;padding:1rem;border:1px solid #e6eef0;box-shadow:0 12px 30px rgba(2,6,23,.08)}

    @media (max-width:700px){ .center-vocab .word{font-size:1.15rem} .falling-img{width:76px;height:76px} }
  </style>
</head>
<body>
  <header>
    <div class="container title-row">
      <div>
        <a class="back" href="games.html">‚Üê Back</a>
        <strong style="margin-left:.6rem">Vocab Rain</strong>
      </div> 
      <div class="controls">
        <div id="progress" class="meta">Round: 0 / 0</div>
        <div id="score" class="meta">Score: 0</div>
        <div id="best-wrap" class="meta">Best: <strong id="best-score">0</strong></div>
        <button id="reset-best" class="back" title="Reset best score" aria-label="Reset best score">‚ôªÔ∏è</button>
        <button id="mute" class="back" aria-pressed="false" title="Mute audio">üîä</button>
        <button id="help" class="back" title="How to play">‚ùì</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="game-area" id="play-area" aria-live="polite">
      <div class="center-vocab" id="vocab-box" aria-hidden="false">
        <div class="word" id="vocab-word">Click Start to play</div>
      </div>

      <div class="overlay" aria-hidden="true"></div>

      <div id="tutorial" role="dialog" aria-modal="true" aria-labelledby="tutorial-title" style="display:none">
        <div class="panel" role="document">
          <h2 id="tutorial-title">How to play</h2>
          <p style="color:var(--muted)">A vocabulary word appears in the centre. Pictures will fall from the top ‚Äî click the picture that matches the word. Incorrect pictures will disappear (no penalty). Images will never cover the word. The game is 5‚Äì10 rounds per play. Good luck!</p>
          <div style="display:flex;gap:.6rem;justify-content:flex-end;margin-top:.8rem">
            <button id="got-it" class="back">Got it ‚Äî Start</button>
            <button id="got-it-dont-show" class="back">Got it ‚Äî Don't show again</button>
          </div>
        </div>
      </div>

    </div>

    <div style="text-align:center;margin-top:12px">
      <button id="start" class="start-btn" aria-label="Start game">Start Game</button>
    </div>

    <div id="final" class="result" style="display:none" role="status" aria-live="polite"></div>
  </main>

  <footer>
    <div class="container">Click the correct picture to score. Incorrect pictures vanish ‚Äî watch out for tricky ones! ‚úÖ</div>
  </footer>

  <script>
    (function(){
      // Vocab list with correct and distractor image URLs. Each array includes reliable images and fallbacks will provide a safe SVG when needed.
      const FALLBACK = 'data:image/svg+xml;utf8,' + encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' width='200' height='120'><rect fill='%23f3f4f6' width='100%' height='100%'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%236b7280' font-size='14'>Image unavailable</text></svg>");

      const VOCABS = [
        {word:'apple', correct:[
          'https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1574226516831-e1dff420e39d?auto=format&fit=crop&w=200&q=60'
        ], wrong:[
          'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=200&q=60', // dog
          'https://images.unsplash.com/photo-1507143550189-fed454f93097?auto=format&fit=crop&w=200&q=60' // chair
        ]},
        {word:'elephant', correct:[
          'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=220&q=60',
          'https://images.unsplash.com/photo-1558981403-cf8d6c7f25cb?auto=format&fit=crop&w=220&q=60'
        ], wrong:[
          'https://images.unsplash.com/photo-1472214103451-9374bd1c798e?auto=format&fit=crop&w=200&q=60', // cat
          'https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=200&q=60' // plane
        ]},
        {word:'bicycle', correct:[
          'https://images.unsplash.com/photo-1504215680853-026ed2a45def?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1520975912773-40d6e5debb77?auto=format&fit=crop&w=200&q=60'
        ], wrong:[
          'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=200&q=60', // elephant
          'https://images.unsplash.com/photo-1444520944972-6c3b9d6cbf7d?auto=format&fit=crop&w=200&q=60' // guitar
        ]},
        {word:'guitar', correct:[
          'https://images.unsplash.com/photo-1511379938547-c1f69419868d?auto=format&fit=crop&w=200&q=60',
          'https://virtualpiano.net/wp-content/uploads/2020/08/Virtual-Guitar-Online-Virtual-Piano.png'
        ], wrong:[
          'https://images.unsplash.com/photo-1507143550189-fed454f93097?auto=format&fit=crop&w=200&q=60', // chair
          'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=200&q=60' // dog
        ]},
        {word:'umbrella', correct:[
          'https://images.unsplash.com/photo-1503376780353-7e6692767b70?auto=format&fit=crop&w=200&q=60'
        ], wrong:[
          'https://images.unsplash.com/photo-1491897554428-130a60dd4757?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=200&q=60'
        ]},
        {word:'cat', correct:[
          'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1517423440428-a5a00ad493e8?auto=format&fit=crop&w=200&q=60'
        ], wrong:[
          'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1520975912773-40d6e5debb77?auto=format&fit=crop&w=200&q=60'
        ]},
        {word:'banana', correct:[
          'https://images.unsplash.com/photo-1574226516831-e1dff420e39d?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1502741126161-b048400d7f3f?auto=format&fit=crop&w=200&q=60'
        ], wrong:[
          'https://images.unsplash.com/photo-1507143550189-fed454f93097?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1520975912773-40d6e5debb77?auto=format&fit=crop&w=200&q=60'
        ]},
        {word:'dog', correct:[
          'https://images.unsplash.com/photo-1507149833265-60c372daea22?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1517423440428-a5a00ad493e8?auto=format&fit=crop&w=200&q=60'
        ], wrong:[
          'https://images.unsplash.com/photo-1511379938547-c1f69419868d?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1504215680853-026ed2a45def?auto=format&fit=crop&w=200&q=60'
        ]},
        {word:'car', correct:[
          'https://images.unsplash.com/photo-1502877338535-766e1452684a?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1511919884226-fd3cad34687c?auto=format&fit=crop&w=200&q=60'
        ], wrong:[
          'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=200&q=60'
        ]},
        {word:'house', correct:[
          'https://images.unsplash.com/photo-1505691723518-36a6a51f15ef?auto=format&fit=crop&w=200&q=60'
        ], wrong:[
          'https://images.unsplash.com/photo-1507143550189-fed454f93097?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1491897554428-130a60dd4757?auto=format&fit=crop&w=200&q=60'
        ]},
        {word:'bird', correct:[
          'https://images.unsplash.com/photo-1501700493788-fa1a7ddf9a98?auto=format&fit=crop&w=200&q=60'
        ], wrong:[
          'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=200&q=60',
          'https://images.unsplash.com/photo-1520975912773-40d6e5debb77?auto=format&fit=crop&w=200&q=60'
        ]}
      ];

      // Validate remote image URLs; mark broken or visually invalid ones so we can use the FALLBACK instead
      const brokenImages = new Set();

      // Check whether an image is mostly dark (returns Promise<boolean>)
      function checkBrightness(img, sampleSize = 40, threshold = 18){
        return new Promise(resolve => {
          try{
            const canvas = document.createElement('canvas');
            const w = sampleSize, h = sampleSize;
            canvas.width = w; canvas.height = h;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, w, h);
            const data = ctx.getImageData(0,0,w,h).data;
            let total = 0, count = 0;
            // sample every 4th pixel to keep it fast
            for (let i = 0; i < data.length; i += 4*4){ const r = data[i], g = data[i+1], b = data[i+2]; const lum = 0.2126*r + 0.7152*g + 0.0722*b; total += lum; count++; }
            const avg = total / Math.max(1, count);
            resolve(avg < threshold);
          }catch(e){
            // Canvas access may be blocked by CORS; assume it's okay in that case
            resolve(false);
          }
        });
      }

      function precheckImages(timeoutMs = 3500){
        const urls = new Set();
        VOCABS.forEach(v => { v.correct.forEach(u => urls.add(u)); v.wrong.forEach(u => urls.add(u)); });
        urls.forEach((url) => {
          try{
            const img = new Image();
            img.crossOrigin = 'anonymous';
            let done = false;
            img.onload = () => { done = true; checkBrightness(img).then(isDark => { if (isDark) brokenImages.add(url); }); };
            img.onerror = () => { done = true; brokenImages.add(url); };
            img.src = url;
            setTimeout(() => { if (!done) brokenImages.add(url); }, timeoutMs);
          }catch(e){ brokenImages.add(url); }
        });
      }

      function escapeHTML(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }
      function localFallbackFor(word){ const label = escapeHTML(word || 'Image'); const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='200' height='120'><rect fill='%23f3f4f6' width='100%' height='100%'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' fill='%236b7280' font-size='20'>${label}</text></svg>`; return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg); }
      function resolveImageSrc(src, word){ return brokenImages.has(src) ? localFallbackFor(word) : src; }

      // Shuffle and prepare a play pool so rounds don't repeat words
      function shuffleArray(a){ for (let i = a.length - 1; i > 0; i--){ const j = Math.floor(Math.random()*(i+1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }
      let activeVocabPool = [];
      function prepareVocabPool(){ activeVocabPool = shuffleArray(VOCABS.slice()); }

      // start prechecking images immediately (async)
      precheckImages();

      const playArea = document.getElementById('play-area');
      const vocabWordEl = document.getElementById('vocab-word');
      const startBtn = document.getElementById('start');
      const muteBtn = document.getElementById('mute');
      const progressEl = document.getElementById('progress');
      const scoreEl = document.getElementById('score');
      const finalBox = document.getElementById('final');

      // Sound (small tones)
      const Sound = (function(){ let ctx=null, master=null, muted = localStorage.getItem('muted') === 'true';
        function init(){ if (ctx) return; try { ctx = new (window.AudioContext || window.webkitAudioContext)(); master = ctx.createGain(); master.connect(ctx.destination); master.gain.value = muted ? 0 : 1; } catch(e){ console.warn('Audio init failed', e); }}
        function tone(freq,dur=0.06,type='sine',vol=0.09){ init(); if (!ctx) return; const o = ctx.createOscillator(); const g = ctx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(master); o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + dur); o.stop(ctx.currentTime + dur + 0.02); }
        return { click(){ tone(880,0.04,'square',0.08); }, hover(){ tone(1400,0.02,'sine',0.03); }, correct(){ tone(880,0.12,'sine',0.12); setTimeout(()=>tone(1320,0.08,'sine',0.12),120); }, wrong(){ tone(220,0.14,'sawtooth',0.12); }, toggle(){ init(); muted = !muted; if (master) master.gain.value = muted ? 0 : 1; localStorage.setItem('muted', String(muted)); return muted; }, isMuted(){ return muted; } };
      })();

      // Game state
      let roundsToPlay = 0, currentRound = 0, score = 0;
      let spawnInterval = null, spawnSinceCorrect = 0, haveSpawnedCorrect = false;
      let currentVocab = null;

      function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
      function pickVocab(){ if (!activeVocabPool || activeVocabPool.length === 0) prepareVocabPool(); return activeVocabPool.shift(); }

      function startGame(){ prepareVocabPool(); roundsToPlay = randInt(5,10); roundsToPlay = Math.min(roundsToPlay, activeVocabPool.length); currentRound = 0; score = 0; finalBox.style.display='none'; updateUI(); nextRound(); }
      function updateUI(){ progressEl.textContent = `Round: ${currentRound} / ${roundsToPlay}`; scoreEl.textContent = `Score: ${score}`; }

      function clearFalling(){ const els = playArea.querySelectorAll('.falling-img, .img-btn'); els.forEach(e=>e.remove()); }

      function nextRound(){ currentRound += 1; updateUI(); clearFalling(); spawnSinceCorrect = 0; haveSpawnedCorrect = false;
        if (currentRound > roundsToPlay){ endGame(); return; }
        const pick = pickVocab(); currentVocab = pick; playRoundFor(pick);
      }

      function endGame(){ vocabWordEl.textContent = `Game complete ‚Äî your score ${score} / ${roundsToPlay}`; finalBox.style.display='block'; finalBox.textContent = `Well done! You scored ${score} out of ${roundsToPlay}. Click Start Game to play again.`; currentRound = roundsToPlay; updateUI(); }

      // spawn images around center box (avoid overlapping it)
      function spawnImage(){ if (!currentVocab) return; spawnSinceCorrect += 1;
        let labelIsCorrect = false; const chanceCorrect = haveSpawnedCorrect ? 0.12 : 0.18; if (Math.random() < chanceCorrect){ labelIsCorrect = true; haveSpawnedCorrect = true; }
        // force correct after several spawns
        if (!haveSpawnedCorrect && spawnSinceCorrect >= 7){ labelIsCorrect = true; haveSpawnedCorrect = true; }

        // pick image src (keep originalSrc to mark bad remote URLs)
        let originalSrc;
        if (labelIsCorrect){ originalSrc = currentVocab.correct[randInt(0,currentVocab.correct.length-1)]; }
        else { const pool = currentVocab.wrong; originalSrc = pool[randInt(0,pool.length-1)]; }
        // if an image was detected as broken earlier, use a per-word local fallback
        let src = resolveImageSrc(originalSrc, currentVocab.word);

        // create button wrapper
        const btn = document.createElement('button'); btn.className = 'img-btn'; btn.style.position = 'absolute'; btn.style.top = '-140px'; btn.style.background = 'transparent'; btn.style.border = '0'; btn.style.padding = '0'; btn.style.zIndex = 30; btn.setAttribute('aria-label', `Picture${labelIsCorrect? ' (correct)':''}`);
        btn.dataset.correct = labelIsCorrect ? 'true' : 'false'; btn.tabIndex = 0;

        const img = document.createElement('img'); img.className = 'falling-img'; img.decoding = 'async'; img.loading = 'lazy'; img.alt = currentVocab.word + (labelIsCorrect? ' ‚Äî correct image' : ' ‚Äî incorrect image');
        img.width = 90; img.height = 90; img.draggable = false; img.crossOrigin = 'anonymous'; img.src = src;
        img.onload = function(){ // if this wasn't already a fallback, detect very-dark images and replace with a local fallback and remember the remote as broken
          const localFb = localFallbackFor(currentVocab.word);
          if (this.src !== localFb && this.src !== FALLBACK){ checkBrightness(this).then(isDark => { if (isDark){ brokenImages.add(originalSrc); this.src = localFb; } }); }
        };
        img.onerror = function(){ this.onerror=null; brokenImages.add(originalSrc); this.src = localFallbackFor(currentVocab.word); };

        // avoid spawning over center area
        const playRect = playArea.getBoundingClientRect(); const centerEl = document.getElementById('vocab-box'); const centerRect = centerEl.getBoundingClientRect();
        const imgW = 90; // use same as CSS size
        const forbiddenLeftMin = Math.max(0, centerRect.left - playRect.left - imgW - 8);
        const forbiddenLeftMax = Math.min(playRect.width - imgW, centerRect.right - playRect.left + 8);

        let attempts = 0; let leftPx;
        do { leftPx = randInt(8, playRect.width - imgW - 8); attempts++; } while (leftPx >= forbiddenLeftMin && leftPx <= forbiddenLeftMax && attempts < 30);
        // fallback: if failed to avoid, nudge to edge
        if (leftPx >= forbiddenLeftMin && leftPx <= forbiddenLeftMax){ if (leftPx < playRect.width / 2) leftPx = forbiddenLeftMin - imgW - 8; else leftPx = forbiddenLeftMax + imgW + 8; leftPx = Math.max(8, Math.min(playRect.width - imgW - 8, leftPx)); }

        btn.style.left = leftPx + 'px';

        // animation duration
        const dur = (randInt(45,85)/10); img.style.animation = `fall ${dur}s linear forwards`;

        // click handler
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); if (btn.dataset.correct === 'true'){ Sound.correct(); score += 1; updateUI(); onRoundWin(); } else { Sound.wrong(); btn.remove(); } });
        btn.addEventListener('keydown', (e)=>{ if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); } });

        // remove after fall
        img.addEventListener('animationend', ()=>{ btn.remove(); });

        btn.appendChild(img); playArea.appendChild(btn);
      }

      function playRoundFor(item){ vocabWordEl.textContent = item.word; document.querySelector('.status') && (document.querySelector('.status').textContent = 'Click the image that matches the word.');
        spawnInterval = setInterval(spawnImage, 700);
        for (let i=0;i<3;i++) setTimeout(spawnImage, i*220);
      }

      function onRoundWin(){ clearInterval(spawnInterval); spawnInterval = null; const remain = playArea.querySelectorAll('.img-btn'); remain.forEach(b => b.remove()); setTimeout(()=>{ if (currentRound < roundsToPlay) nextRound(); else endGame(); }, 700); }

      // Start/mute/help/tutorial controls
      startBtn.addEventListener('click', ()=>{ Sound.click(); const seen = localStorage.getItem('seenVocabTutorial') === 'true'; if (!seen){ showTutorial(); } else { startGame(); } });
      const tutorial = document.getElementById('tutorial'); const gotIt = document.getElementById('got-it'); const gotItNoShow = document.getElementById('got-it-dont-show');
      const helpBtn = document.getElementById('help'); function showTutorial(){ tutorial.style.display = 'flex'; const ov = document.querySelector('.overlay'); if (ov){ ov.style.pointerEvents = 'auto'; ov.style.background = 'rgba(2,6,23,0.06)'; } tutorial.querySelector('button')?.focus(); }
      function hideTutorial(){ tutorial.style.display = 'none'; const ov = document.querySelector('.overlay'); if (ov){ ov.style.pointerEvents = 'none'; ov.style.background = 'linear-gradient(180deg,transparent 0%, rgba(2,6,23,0.02) 100%)'; } }
      gotIt.addEventListener('click', ()=>{ localStorage.setItem('seenVocabTutorial','true'); hideTutorial(); startGame(); });
      gotItNoShow.addEventListener('click', ()=>{ localStorage.setItem('seenVocabTutorial','true'); hideTutorial(); startGame(); });
      helpBtn.addEventListener('click', showTutorial);

      // Mute
      muteBtn.addEventListener('click', ()=>{ const m = Sound.toggle(); muteBtn.setAttribute('aria-pressed', String(m)); muteBtn.textContent = m ? 'üîà' : 'üîä'; muteBtn.focus(); });
      (function(){ const m = localStorage.getItem('muted') === 'true'; muteBtn.setAttribute('aria-pressed', String(m)); muteBtn.textContent = m ? 'üîà' : 'üîä'; })();

      // Best score
      let bestScore = parseInt(localStorage.getItem('vocabGameBest') || '0',10) || 0; const bestScoreEl = document.getElementById('best-score'); const resetBestBtn = document.getElementById('reset-best'); function updateBestUI(){ bestScoreEl.textContent = String(bestScore); } updateBestUI(); resetBestBtn.addEventListener('click', ()=>{ if (confirm('Reset best score?')){ bestScore = 0; localStorage.setItem('vocabGameBest','0'); updateBestUI(); } });

      // Update best when game ends
      const originalEndGame = endGame; window.endGame = function(){ originalEndGame(); if (score > bestScore){ bestScore = score; localStorage.setItem('vocabGameBest', String(bestScore)); updateBestUI(); finalBox.textContent = `New personal best! You scored ${score} out of ${roundsToPlay}.`; } else { finalBox.textContent = `Game complete ‚Äî your score ${score} / ${roundsToPlay}`; } };

      // initial tutorial show
      if (localStorage.getItem('seenVocabTutorial') !== 'true') showTutorial();

      // navigate back/forward quickly
      const toGames = document.querySelector('a.back[href="games.html"]'); // nothing to do

      // ensure hover sounds
      playArea.addEventListener('mouseover', (e)=>{ if (e.target.matches('.falling-img')) Sound.hover(); });

      // Clean up
      window.addEventListener('beforeunload', ()=>{ clearInterval(spawnInterval); });

    })();
  </script>
</body>
</html>